<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EsToDoList (Light/Dark Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos Sketch Border (Padrão: Light Mode - Borda Preta) */
        .sketch-border {
            border: 2px solid black;
            border-radius: 10px;
            box-shadow: 4px 4px 0px 0px rgba(0,0,0,0.8);
            transition: all 0.1s ease-in-out;
        }
        .sketch-border:hover {
            box-shadow: 2px 2px 0px 0px rgba(0,0,0,0.8);
            transform: translate(2px, 2px);
        }

        /* Estilos Sketch Border (Dark Mode - Borda Branca) */
        .dark .sketch-border {
            border: 2px solid white; 
            box-shadow: 4px 4px 0px 0px rgba(255,255,255,0.8);
        }
        .dark .sketch-border:hover {
            box-shadow: 2px 2px 0px 0px rgba(255,255,255,0.8);
            transform: translate(2px, 2px);
        }

        /* Task Item (Shared) */
        .task-item {
            border-radius: 8px;
        }
        /* Task Item Border (Light Mode - Padrão: Borda Preta) */
        .task-item.todo {
            border: 2px solid black;
        }
        .task-item.done {
            border: 4px solid #22c55e; /* green-500 */
            opacity: 0.7;
        }
        /* Task Item Border (Dark Mode - Borda Branca) */
        .dark .task-item.todo {
            border: 2px solid white;
        }

        /* Checkbox (Padrão: Light Mode) */
        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            height: 24px;
            width: 24px;
            border: 2px solid black; /* Borda preta em Light Mode */
            border-radius: 4px;
            background-color: white;
            cursor: pointer;    
            position: relative;
        }

        /* Checkbox (Dark Mode) */
        .dark input[type="checkbox"] {
            border: 2px solid white; /* Borda branca em Dark Mode */
            background-color: #1f2937; /* bg-gray-800 */
        }
        
        /* Checkbox Checked State (Shared - verde) */
        input[type="checkbox"]:checked {
            background-color: #22c55e; /* green-500 */
            border-color: #22c55e;
        }
        /* Checkmark (Shared - branco) */
        input[type="checkbox"]:checked::before {
            content: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="white"><path fill-rule="evenodd" d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.81 3.81L15.498 4.32a.75.75 0 011.206-.167z" clip-rule="evenodd" /></svg>');
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: block;
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 flex justify-center p-8 min-h-screen relative">
    
    <button id="toggle-mode" class="absolute top-8 right-8 p-3 bg-white text-black dark:bg-gray-800 dark:text-white sketch-border">
        </button>
    <div class="flex max-w-4xl w-full space-x-8">

        <div class="flex flex-col space-y-3 pt-24 min-w-max">
            <button id="filter-all" class="px-4 py-2 bg-white text-black dark:bg-gray-800 dark:text-white text-sm font-semibold hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 sketch-border filter-btn active-filter" data-filter="all">
                Todas as Tarefas
            </button>
            <button id="filter-completed" class="px-4 py-2 bg-white text-black dark:bg-gray-800 dark:text-white text-sm font-semibold hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 sketch-border filter-btn" data-filter="completed">
                somente concluídos
            </button>
            <button id="filter-uncompleted" class="px-4 py-2 bg-white text-black dark:bg-gray-800 dark:text-white text-sm font-semibold hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 sketch-border filter-btn" data-filter="uncompleted">
                somente a concluir
            </button>
            <hr class="border-t border-gray-300 dark:border-gray-700 my-2">
            <button id="sort-oldest" class="px-4 py-2 bg-white text-black dark:bg-gray-800 dark:text-white text-sm font-semibold hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 sketch-border sort-btn" data-sort="oldest">
                + antigas primeiro
            </button>
            <button id="sort-newest" class="px-4 py-2 bg-white text-black dark:bg-gray-800 dark:text-white text-sm font-semibold hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 sketch-border sort-btn active-sort" data-sort="newest">
                + recentes primeiro
            </button>
        </div>
        <div class="flex-1 flex flex-col items-center max-w-xl mx-auto">
            
            <h1 class="text-4xl font-bold mb-8 text-black dark:text-white">EsToDoList</h1>

            <div class="w-full flex mb-4">
                <input type="text" id="new-task-input" placeholder="Digite uma tarefa..." 
                        class="flex-1 px-4 py-3 bg-white text-black dark:bg-gray-800 dark:text-white dark:border-white text-lg outline-none sketch-border border-r-0 rounded-r-none focus:ring-0">
                <button id="add-task-btn" class="bg-white text-black dark:bg-gray-800 dark:text-white px-4 py-3 sketch-border rounded-l-none hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 dark:border-white">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                </button>
            </div>

            <div class="w-full flex mb-8">
                <input type="text" id="search-input" placeholder="Pesquisar tarefas..." 
                        class="flex-1 px-4 py-3 bg-white text-black dark:bg-gray-800 dark:text-white dark:border-white text-lg outline-none sketch-border border-r-0 rounded-r-none focus:ring-0">
                <button id="search-btn" class="bg-white text-black dark:bg-gray-800 dark:text-white px-4 py-3 sketch-border rounded-l-none hover:bg-gray-100 active:bg-gray-200 dark:hover:bg-gray-700 dark:active:bg-gray-600 dark:border-white">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.197 5.197a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                </button>
            </div>

            <div id="task-list" class="w-full space-y-4">
                </div>

        </div>
    </div>
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->
<!-----------------------------------------------------------------------------------------JS-------------------------------------------------------------------------------->

    <script>
    // Seletores de Elementos do DOM
    const listaTarefasEl = document.getElementById('task-list');
    const inputNovaTarefa = document.getElementById('new-task-input');
    const botaoAdicionarTarefa = document.getElementById('add-task-btn');
    const inputPesquisa = document.getElementById('search-input');
    const botoesFiltro = document.querySelectorAll('.filter-btn');
    const botoesOrdenacao = document.querySelectorAll('.sort-btn');
    const botaoAlternarModo = document.getElementById('toggle-mode');
    const elementoHtml = document.documentElement;

    // Ícones SVG
    const iconeSol = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.585 7.034a.75.75 0 0 0-1.25-.92l-1.442 1.053a.75.75 0 0 0 .92 1.25l1.442-1.053ZM18.331 6.098a.75.75 0 0 0-1.135-.297l-1.393 1.132a.75.75 0 0 0 .964 1.183l1.393-1.132a.75.75 0 0 0 .19-.924ZM12 6a6 6 0 1 1 0 12 6 6 0 0 1 0-12ZM3.75 12a.75.75 0 0 0 0 1.5h2.25a.75.75 0 0 0 0-1.5H3.75ZM18 12a.75.75 0 0 0 0 1.5h2.25a.75.75 0 0 0 0-1.5H18ZM7.034 16.415a.75.75 0 0 0 1.25.92l1.442-1.053a.75.75 0 0 0-.92-1.25l-1.442 1.053ZM16.415 17.034a.75.75 0 0 0 1.25.92l1.442-1.053a.75.75 0 0 0-.92-1.25l-1.442 1.053ZM12 18.75a.75.75 0 0 0-.75.75v2.25a.75.75 0 0 0 1.5 0v-2.25a.75.75 0 0 0-.75-.75Z" /></svg>`;
    const iconeLua = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.546 1.096A10.5 10.5 0 0 0 12 21.5a10.5 10.5 0 0 0 10.454-10.454C22.094 6.784 18.498 3.188 13.954 3.962A7.5 7.5 0 0 1 10.5 7.5c0 4.004-3.528 7.272-7.854 7.424C4.188 18.498 7.784 22.094 12 22.5c5.786 0 10.5-4.714 10.5-10.5S17.786 1.5 12 1.5c-2.486 0-4.793.85-6.685 2.296C6.678 3.197 9.17 1.282 9.546 1.096Z" clip-rule="evenodd" /></svg>`;


    let tarefas = []; // Array principal de tarefas
    let filtroAtual = 'all';
    let ordenacaoAtual = 'newest';

    // --- Funções Auxiliares de Estado e Persistência ---

    /** Atualiza o ícone do botão Dark Mode (sol/lua) */
    function atualizarIconeModo() {
        const isDark = elementoHtml.classList.contains('dark');
        botaoAlternarModo.innerHTML = isDark ? iconeSol : iconeLua;
    }

    /** Carrega tarefas do Local Storage ou usa tarefas iniciais. */
    function carregarTarefas() {
        const tarefasArmazenadas = localStorage.getItem('esToDoListTasks');
        if (tarefasArmazenadas) {
            tarefas = JSON.parse(tarefasArmazenadas).map(tarefa => ({
                ...tarefa,
                timestamp: new Date(tarefa.timestamp) 
            }));
        } else {
            const agora = Date.now();
            tarefas = [
                { id: agora + 1, text: "Fazer o desafio EsToDoList funcional", completed: true, timestamp: new Date(agora - 86400000) },
                { id: agora + 2, text: "Corrigir os estilos para Light Mode", completed: false, timestamp: new Date(agora) }
            ];
        }
    }

    /** Salva as tarefas no Local Storage. */
    function salvarTarefas() {
        localStorage.setItem('esToDoListTasks', JSON.stringify(tarefas));
    }

    /** Salva o modo atual (dark/light) no Local Storage. */
    function salvarPreferenciaModo() {
        const isDark = elementoHtml.classList.contains('dark');
        localStorage.setItem('esToDoListMode', isDark ? 'dark' : 'light');
    }

    /** Carrega o modo preferido do Local Storage. */
    function carregarPreferenciaModo() {
        const modoPreferido = localStorage.getItem('esToDoListMode');
        if (modoPreferido === 'dark') {
            elementoHtml.classList.add('dark');
        } else {
            elementoHtml.classList.remove('dark'); 
        }
        atualizarIconeModo();
    }

    /** Cria o HTML para um item de tarefa. */
    function criarElementoTarefa(tarefa) {
        const classeTarefa = tarefa.completed ? 'done' : 'todo';
        const classeTexto = tarefa.completed ? 'text-gray-500 line-through dark:text-gray-400' : 'text-black dark:text-white';
        
        const divTarefa = document.createElement('div');
        divTarefa.className = `task-item bg-white dark:bg-gray-800 p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 ${classeTarefa}`;
        divTarefa.dataset.id = tarefa.id;

        divTarefa.innerHTML = `
            <div class="flex items-center space-x-4">
                <input type="checkbox" id="task-${tarefa.id}" ${tarefa.completed ? 'checked' : ''} data-id="${tarefa.id}">
                <label for="task-${tarefa.id}" class="text-xl ${classeTexto}">${tarefa.text}</label>
            </div>
            <div class="flex items-center space-x-3">
                <button class="text-yellow-600 hover:text-yellow-700 edit-btn" data-id="${tarefa.id}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 17.25H5.75V12.416l10.92-10.92Z" />
                    </svg>
                </button>
                <button class="text-red-500 hover:text-red-600 delete-btn" data-id="${tarefa.id}">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9.497-.365 7.3a1.5 1.5 0 0 1-1.493 1.353H9.118a1.5 1.5 0 0 1-1.493-1.353l-.366-7.3m10.875 0V7.5A2.25 2.25 0 0 0 18 5.25h-4.5V3.75a1.5 1.5 0 0 0-3 0v1.5H6A2.25 2.25 0 0 0 3.75 7.5v1.997m-.75 0 1.954 11.666A3.75 3.75 0 0 0 8 22.5h8.5a3.75 3.75 0 0 0 3.546-2.837L21.75 9.497" />
                    </svg>
                </button>
            </div>
        `;
        return divTarefa;
    }

    // --- Lógica Principal de Renderização ---
    function renderizarTarefas() {
        let tarefasFiltradas = tarefas;
        const termoPesquisa = inputPesquisa.value.toLowerCase();

        // 1. Pesquisa
        if (termoPesquisa.length > 0) {
            tarefasFiltradas = tarefasFiltradas.filter(tarefa =>
                tarefa.text.toLowerCase().includes(termoPesquisa)
            );
        }

        // 2. Filtragem
        if (filtroAtual === 'completed') {
            tarefasFiltradas = tarefasFiltradas.filter(tarefa => tarefa.completed);
        } else if (filtroAtual === 'uncompleted') {
            tarefasFiltradas = tarefasFiltradas.filter(tarefa => !tarefa.completed);
        }

        // 3. Ordenação
        tarefasFiltradas.sort((a, b) => {
            if (ordenacaoAtual === 'newest') {
                return b.timestamp - a.timestamp; 
            } else if (ordenacaoAtual === 'oldest') {
                return a.timestamp - b.timestamp; 
            }
            return 0;
        });

        // 4. Renderização no DOM
        listaTarefasEl.innerHTML = ''; 
        if (tarefasFiltradas.length === 0) {
             listaTarefasEl.innerHTML = `<p class="text-gray-500 dark:text-gray-400 text-center mt-8">Nenhuma tarefa encontrada. 😢</p>`;
        } else {
            tarefasFiltradas.forEach(tarefa => {
                listaTarefasEl.appendChild(criarElementoTarefa(tarefa));
            });
        }
    }

    // --- Funções de Manipulação de Tarefas (CRUD) ---

    function adicionarTarefa() {
        const texto = inputNovaTarefa.value.trim();
        if (texto === "") return;
        const novaTarefa = {
            id: Date.now(),
            text: texto,
            completed: false,
            timestamp: new Date()
        };
        tarefas.push(novaTarefa);
        inputNovaTarefa.value = '';
        salvarTarefas();
        renderizarTarefas();
    }

    function deletarTarefa(id) {
        tarefas = tarefas.filter(tarefa => tarefa.id !== id);
        salvarTarefas();
        renderizarTarefas();
    }

    function alternarConclusaoTarefa(id) {
        const tarefa = tarefas.find(tarefa => tarefa.id === id);
        if (tarefa) {
            tarefa.completed = !tarefa.completed;
            salvarTarefas();
            renderizarTarefas(); 
        }
    }

    function editarTarefa(id) {
        const tarefa = tarefas.find(tarefa => tarefa.id === id);
        if (!tarefa) return;
        const novoTexto = prompt("Edite a tarefa:", tarefa.text);
        if (novoTexto && novoTexto.trim() !== "" && novoTexto.trim() !== tarefa.text) {
            tarefa.text = novoTexto.trim();
            salvarTarefas();
            renderizarTarefas();
        }
    }


    // --- Configuração de Event Listeners ---

    // Adicionar Tarefa
    botaoAdicionarTarefa.addEventListener('click', adicionarTarefa);
    inputNovaTarefa.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') adicionarTarefa();
    });
    
    // Pesquisa
    inputPesquisa.addEventListener('input', renderizarTarefas);
    
    // Delegação de Eventos para a Lista de Tarefas (Checkbox, Delete, Edit)
    listaTarefasEl.addEventListener('click', (e) => {
        const id = parseInt(e.target.dataset.id || e.target.closest('button')?.dataset.id);
        if (!id) return;
        
        if (e.target.type === 'checkbox') {
            alternarConclusaoTarefa(id);
        } else if (e.target.closest('.delete-btn')) {
            deletarTarefa(id);
        } else if (e.target.closest('.edit-btn')) {
            editarTarefa(id);
        }
    });

    // Filtragem
    botoesFiltro.forEach(botao => {
        botao.addEventListener('click', () => {
            const novoFiltro = botao.dataset.filter;
            if (filtroAtual === novoFiltro) {
                filtroAtual = 'all'; 
            } else {
                filtroAtual = novoFiltro;
            }
            
            botoesFiltro.forEach(btn => btn.classList.remove('active-filter'));
            if (filtroAtual === 'all') {
                document.getElementById('filter-all').classList.add('active-filter');
            } else {
                 botao.classList.add('active-filter');
            }
            
            renderizarTarefas();
        });
    });
    
    // Ordenação
    botoesOrdenacao.forEach(botao => {
        botao.addEventListener('click', () => {
            ordenacaoAtual = botao.dataset.sort;
            
            botoesOrdenacao.forEach(btn => btn.classList.remove('active-sort'));
            botao.classList.add('active-sort');
            
            renderizarTarefas();
        });
    });

    // Alternar Modo (Dark/Light)
    botaoAlternarModo.addEventListener('click', () => {
        elementoHtml.classList.toggle('dark');
        salvarPreferenciaModo();
        atualizarIconeModo();
        renderizarTarefas();
    });


    // --- Inicialização da Aplicação ---

    function iniciar() {
        carregarPreferenciaModo();
        carregarTarefas();
        renderizarTarefas();
    }

    iniciar();
</script>

</body>
</html>